<!DOCTYPE html>
<html lang="ko"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/layout}">
<head layout:fragment="head">
    <!-- common head -->
    <th:block th:replace="fragments/layout :: commonHead"></th:block>
    <!-- head -->
    <link rel="stylesheet" th:href="@{/css/member/findId.css}">
    <title>아이디 찾기</title>
</head>

<body layout:fragment="body">
    <div class="wrapper">
        <!-- header -->
        <header th:replace="fragments/layout :: fragNonHeader"></header>
        <!-- //header -->

        <!-- main -->
        <main class="main container">
            <div class="title content">
                <h1>아이디를 잊으셨습니까?</h1>
            </div>
            <div class="wrap-find-id content">
                <div class="find-id-title">
                    <h2>아이디 찾기</h2>
                </div>
                <div class="input-data content">
                    <div class="name">
                        <i class="icon__name fa-regular fa-address-card"></i>
                        <i class="bar__name"></i>
                        <input id="inputName" type="text" placeholder="이름을 입력하세요." />
                    </div>
                    <div class="email">
                        <i class="icon__email fa-regular fa-envelope"></i>
                        <i class="bar__email"></i>
                        <input id="inputEmail" type="email" placeholder="이메일 주소를 입력하세요." />
                    </div>
                </div>
                <div class="wrap-confirm-btn content">
                    <button type="button" class="btn confirm-btn">확인</button>
                </div>
            </div>
        </main>
        <!-- //main -->

        <!-- footer -->
        <footer th:replace="fragments/layout :: fragFooter" class="footer container"></footer>
        <!-- //footer -->

        <!-- 모달 팝업 -->
        <div class="background">
            <div class="wrap-pop-up">
                <div class="pop-up">
                    <div class="msg-find-id">
                        <h2>아이디 찾기가 완료되었습니다.</h2>
                        <div class="msg">
                            <p><label for="">회원님의 아이디는 <span class="span-id">abc1234</span> 입니다.</label></p>
                            <p><label for="">가입일자는 <span class="span-reg">2022.08.15</span> 입니다.</label></p>
                        </div>
                    </div>
                    <div class="location-choice">
                        <a th:href="@{/findPw}"> 비밀번호 찾기 </a>
                        <a th:href="@{/login}"> 로그인 </a>
                    </div>
                </div>
            </div>
        </div>
        <!-- //모달 팝업 -->
    </div>

    <script>
        const $confirmBtn = document.querySelector('.confirm-btn');
        const $spanId = document.querySelector('.span-id');
        const $spanReg = document.querySelector('.span-reg');

        $confirmBtn.addEventListener('click', e => {
            $spanId.textContent = '찾은 아이디';
            $spanReg.textContent = '찾은 등록일자';

            const name = inputName.value;
            const email = inputEmail.value;
            findId(name, email);

            console.log(name, email);

            document.querySelector(".background").className = "background show";
           
        });

        function findId(name, email) {
            const url = `/api/member/findId`;
            const data = { "memName" : name, "memEmail" : email };
            fetch(url, {
                method:'POST',
                headers:{
                  'Accept':'application/json',
                  'Content-type': 'application/json'
                },
                body: JSON.stringify(data)
            }).then(res => res.json())
              .then(res => {
                console.log(res);
                if (res.header.rtcd == '00') {
                    res.data[1] = res.data[1].substr(0, 10);
                    $spanId.textContent = res.data[0];
                    $spanReg.textContent = res.data[1];
                } else {
                    console.log(res);
                }
              }).catch(err => console.log(err));
        }
    </script>
</body>
</html>